<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" type="text/css" href="style.css" />
        <title>Rockeatseat | Evolua rápido como a tecnologia.</title>
        <link rel="icon" type="imagem/png" href="https://i.imgur.com/Dwt7WW5.png" />
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    </head>
    <body>
        <header>
            <div class="cab">
                <div class="icone">
                        <div class="icone-fig">
                            <a href="https://rocketseat.com.br" >
                                <img src="https://i.imgur.com/zcbk0uI.png">
                            </a>
                        </div>
                        <div class="manifesto">
                            <a href="https://rocketseat.com.br/manifesto" >Manifesto</a>
                        </div>
                </div>  
                <div class="campos">      
                    <label for="fname">Usuario:</label>
                    <input type="text" id="fname" name="fname" style="color:black"><br><br>
                    <label for="lname">Senha:</label>
                    <input type="text" id="lname" name="lname" style="color:black"><br><br> 
                    <label for="lname" id="wrongData"style="color :rgb(202, 7, 7); display:none">Usuario ou senha Inválidos</label>    
                </div>      
                <div class="hideButtonLabel">
                    <button class="button" id="loggingButton" >
                        Logar
                    </button> 
                </div>
                <div class="button1">
                    <button class="button" id='showUserButton'">
                        Entrar
                    </button> 
                </div>
                <div class="button2">
                    <button class="button" id='logoffButton'>
                        Sair
                    </button> 
                </div>
            </div>  

        </header>

        <div class="div1" id="searchDiv" style="text-align: center">

            <h1 class="h1"> Pesquise um pokémon<b>.</b> </h1>
            <input type="text" id="pokInput" name="pokInput" style="color:black"><br><br>  

            <label for="lname" id="wrongSearchData"style="color :rgb(202, 7, 7); display:none">Esta busca não existe</label> 

            <div class="button2">
                <button class="button" id='searchButton' style="width: 25%;">
                    Buscar
                </button> 
            </div>         

            <div class="infoPokDiv" style="margin-top: 70px; display: none;">            
                <div class="infoPok">
                    <img src="" id="pokeImg" alt="some text" width=120 height=120>
                    <label for="pokInputName" id="pokInputName" width=120 height=120>pokemon name</label>  
                </div> 
                
                <label for="pokInputId" id="pokInputId" width=120 height=120>pokemon id</label>  
                <label for="pokInputWeight" id="pokInputWeight" width=120 height=120 style="margin-left: 15px;">pokemon weight</label>  
            </div>
        </div>

        <div class="div1">
            <h1 class="h1"> Evolua rápido como a tecnologia<b>.</b> </h1>
        </div>

        <div class="div2">
            <p>Junte-se a milhares de devs e acelere<br> na direção de seus objetivos.</p>
            <div class="button" >
                <button class="button">
                    <a href="https://app.rocketseat.com.br/signup" >Embarcar no Foguete</a>
                </button>
            </div>
        </div>

        <div class="div3">
                <a>
                    <img src="https://i.imgur.com/vkauJuZ.png">
                </a>  
        </div>

        <script type="text/javascript" charset="utf-8">
        var butEntrar = document.querySelector("#showUserButton"),
            hideUserLogin = document.querySelector(".campos"),
            firstButton = document.querySelector(".button1")
            hideButtonLogin = document.querySelector(".hideButtonLabel"),
            butLogin = document.querySelector("#loggingButton"),
            butLogoff = document.querySelector("#logoffButton"),
                        
            userInput = document.querySelector("#fname"),
            passInput = document.querySelector("#lname"),
            hidingText = document.querySelector("#wrongData"),

            pokInput = document.querySelector("#pokInput"),
            pokInputId = document.querySelector("#pokInputId"),
            pokInputWeight = document.querySelector("#pokInputWeight"),
            pokInputName = document.querySelector("#pokInputName"),
            searchDiv = document.querySelector("#searchDiv"),
            infoPokDiv = document.querySelector(".infoPokDiv"),
            pokeImg = document.querySelector("#pokeImg"),
            wrongSearchData = document.querySelector("#wrongSearchData"),
            searchButton = document.querySelector("#searchButton");

        butEntrar.addEventListener("click", function(){
            hideUserLogin.className= 'campos show'
            hideButtonLogin.className= 'hideLogin show'
            firstButton.style.display = 'none';
            butLogin.style.display= 'block';
        });   
        
        butLogoff.addEventListener("click", function(){
            localStorage.setItem('acesso', 'false');
            stateToLog();
            infoPokDiv.style.display= 'none';
        });

        searchButton.addEventListener("click", function(){
            if(pokInput.value.length < 1){
                wrongSearchData.style.display='block';
                return false;
            }
            
            wrongSearchData.style.display='none';

            infoPokDiv.style.display= 'block';
            searchApi();
        });       
        
        const searchApi =() =>{

            axios.get('https://pokeapi.co/api/v2/pokemon/'+pokInput.value.toLowerCase()+'')
                .then(function (poke){
                    pokeImg.src = 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/'+poke.data.id+'.png';
                    pokInputName.innerHTML = 'Nome: '+ poke.data.name;
                    pokInputId.innerHTML = 'Número Pokedex: '+ poke.data.id;
                    pokInputWeight.innerHTML = 'Peso: '+ poke.data.weight+ 'lbs';
                }).catch(() => {
                    wrongSearchData.style.display='block';
                    infoPokDiv.style.display= 'none';
                    return false;
                });

            pokInput.value = '';
        }

        const stateLogged = () => {
            hideUserLogin.className= 'campos none';
            hideButtonLogin.className= 'hideLogin none';
            butLogin.style.display= 'none';
            firstButton.style.display = 'none';
            butLogoff.style.display= 'block';
            userInput.value = '';
            passInput.value = '';
            searchDiv.style.display='block';
        }
        
        const stateToLog = () => {
            searchDiv.style.display='none';
            butLogin.style.display= 'none';
            firstButton.style.display= 'block';
            butLogoff.style.display= 'none';
        }        

        if(localStorage.getItem('acesso') == 'true'){
            stateLogged();
        }else {
            stateToLog();
        }

        butLogin.addEventListener("click", function(event){
            event.preventDefault();

            
            if (userInput.value.length < 3 || passInput.value.length < 3){
                hidingText.style.display= 'block';
                hidingText.innerHTML = 'Os campos devem ter mais que 3 caracteres!';
                return false;
            }            

            fetch('https://reqres.in/api/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email: userInput.value,
                    password: passInput.value,
                })
            }).then((response) =>{
                if(response.status != 200){
                    hidingText.style.display= 'block';
                    hidingText.innerHTML = 'Usuário invalido!';
                }else{
                    stateLogged();

                    localStorage.setItem('acesso', 'true');
                }
                return response.json();
            }).catch(() => {

            })  
        });
        </script>
    </body>
</html>
